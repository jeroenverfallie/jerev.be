<!DOCTYPE html>
<html lang="en">

<head>
    <title>Test</title>
    <link rel="stylesheet" type="text/css" href="bower_components/c3/c3.css">
</head>

<body>
    <div id="chart"></div>

    <script src="bower_components/d3/d3.min.js" charset="utf-8"></script>
    <script src="bower_components/c3/c3.min.js"></script>

    <script>
    d3.json("http://site-stuff.175-east-75th-street.boweryapps.com/getcodestats.php", function(json) {
        var columns = [], x = ['x'];

        var languages = [];

        for(var i = 0, n = json.all_languages.length; i < n; i++) {
            var name = json.all_languages[i];
            columns[i+1] = Array.apply(null, new Array(json.days.length+1)).map(Number.prototype.valueOf,0);
            columns[i+1][0] = name;
            languages[name] = i;
        }

        var dates = (function() {
            var out = {};
            for(var i = 0, n = json.days.length; i < n; i++) {
                out[json.days[i].start_date] = i;
            }
            return out;
        })();

        for(var i = 0, n = json.days.length; i < n; i++) {
            var day = json.days[i], sec = day.total_seconds;
            x.push(day.start*1000);

            for(var j = 0, o = day.languages.length; j < o; j++) {
                var l = day.languages[j];

                columns[languages[l.name]+1][dates[day.start_date]+1] = l.percent/100*sec;
            }
        }
        columns[0] = x;

    
        var formatTime = d3.time.format("%Mm %Ss");

        var chart = c3.generate({
            data: {
                x: 'x',
                columns: columns,
                type: 'area-spline',
                groups: [json.all_languages]
            },
            axis: {
                x: {
                    type: 'timeseries',
                    tick: {
                        format: '%a %d %b'
                    }
                },
                y: {
                    tick: {
                        format: function(s) {
                            var h = ~~(s/(60*60)),
                                m = ~~((s%3600)/60),
                                s = ~~(s%60);
                            return h + ':' + m + ':' + s;
                        }
                    }
                }
            }
        });
    });
    </script>
</body>

</html>